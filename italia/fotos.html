<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fotos - Italia Café</title>
    <meta name="robots" content="noindex, nofollow">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css" />
    <link rel="stylesheet" href="/italia/css/style.css" />
    <link rel="stylesheet" href="/italia/css/carrito.css" />

    <style>
        body { padding: 2rem; background-color: #f4f4f9; }
        .admin-container { max-width: 900px; margin: auto; background: #fff; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); display: flex; flex-direction: column; }
        .admin-header { text-align: center; margin-bottom: 2rem; }
        #product-search { width: 100%; padding: 0.8rem; margin-bottom: 1.5rem; border: 1px solid #ccc; border-radius: 8px; }
        .product-list-item { display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-bottom: 1px solid #eee; transition: background-color 0.3s; }
        .product-list-item:last-child { border-bottom: none; } /* Remove border from last item */
        .product-list-item.assigned { background-color: #e8f5e9; }
        .product-list-item .product-list-info { flex-grow: 1; margin: 0 1rem; }
        .product-list-item .product-list-info .name { font-weight: 600; }
        .product-list-item .product-list-info .category { font-size: 0.9em; color: #777; }
        .product-list-img-container {
            width: 60px; /* Small size */
            height: 60px;
            border-radius: 8px; /* Rounded corners */
            overflow: hidden;
            flex-shrink: 0; /* Prevent shrinking */
            background-color: #f0f0f0; /* Placeholder background */
            display: flex; /* For centering image if it doesn't fill */
            align-items: center;
            justify-content: center;
        }
        .product-list-img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Ensure image covers the container */
            display: block;
            cursor: pointer; /* Add cursor to indicate it's clickable */
        }
        .assign-btn { background-color: var(--color-price); color: white; border: none; padding: 0.5rem 1rem; border-radius: 40px; cursor: pointer; transition: transform 0.2s ease; }
        .assign-btn:hover { transform: scale(1.1); }
        .assign-btn:disabled { background-color: #ccc; }
        #output-container { margin-top: 2rem; }
        #output-data { width: 100%; height: 400px; font-family: monospace; font-size: 0.9em; padding: 1rem; border-radius: 8px; border: 1px solid #ccc; }

        /* Custom Modal for Cropper */
        .crop-modal-container {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1050;
            left: 0; top: 0;
            width: 100%; height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
        }
        .crop-modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 12px;
            max-width: 90vw;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }
        .crop-image-wrapper {
            max-width: 60vh; /* Limit cropper size */
            max-height: 60vh;
            margin-bottom: 1rem;
        }
        .crop-modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 1rem;
        }
        .crop-modal-btn {
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }
        .crop-modal-btn.confirm { background-color: var(--color-price); color: white; }
        .crop-modal-btn.cancel { background-color: #ccc; }
    </style>
</head>
<body>

    <div class="admin-container">
        <div class="admin-header">
            <h1><i class="fas fa-camera"></i> Asignar Fotos a Productos</h1>
            <p>Busca un producto y haz clic en "Asignar Imagen" para seleccionar la foto desde tu computadora.</p>
        </div>

        <!-- Este input está oculto, se activa con JavaScript -->
        <input type="file" id="image-input" accept="image/*" style="display: none;">

        <input type="search" id="product-search" placeholder="Buscar producto por nombre...">
        <div id="product-list"></div>

        <div id="output-container">
            <h2>Código `MENU_DATA` actualizado:</h2>
            <textarea id="output-data" readonly placeholder="Aquí aparecerá el código para copiar y pegar en script.js..."></textarea>
        </div>
    </div>

    <!-- Lightbox for viewing images -->
    <div id="lightbox" class="lightbox hidden" role="dialog" aria-modal="true">
        <button id="lightbox-close" class="lightbox-close" aria-label="Cerrar imagen ampliada">&times;</button>
        <img id="lightbox-img" src="" alt="Imagen ampliada del producto" />
    </div>

    <!-- Modal for Cropper.js -->
    <div id="image-crop-modal" class="crop-modal-container">
        <div class="crop-modal-content">
            <h2>Recortar Imagen</h2>
            <p>Ajusta el recuadro para seleccionar la parte de la imagen que se verá en el menú.</p>
            <div class="crop-image-wrapper">
                <img id="image-to-crop" src="">
            </div>
            <div class="crop-modal-actions">
                <button id="crop-cancel-btn" class="crop-modal-btn cancel">Cancelar</button>
                <button id="crop-confirm-btn" class="crop-modal-btn confirm">Confirmar y Asignar</button>
            </div>
        </div>
    </div>

    <script src="js/script.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
    <script src="js/admin-fotos.js"></script>

</body>
</html>